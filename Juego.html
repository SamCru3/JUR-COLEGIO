<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laberinto de Basura 2D - Responsivo</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #1d1d1d;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }

    h1 { margin-bottom: 10px; text-align: center; }

    #game-view {
      width: 90vw;
      height: 70vh;
      border: 3px solid #00b894;
      overflow: hidden;
      position: relative;
      background: #2e2e2e;
      touch-action: none;
    }

    #game-container {
      position: absolute;
      display: grid;
      grid-template-columns: repeat(30, var(--cell-size));
      grid-template-rows: repeat(30, var(--cell-size));
      gap: 2px;
      transition: left 0.1s, top 0.1s;
    }

    .cell {
      width: var(--cell-size);
      height: var(--cell-size);
    }
    .wall { background: #636e72; }
    .player { background: #0984e3; border-radius: 5px; }
    .trash { background: #fdcb6e; border-radius: 50%; }
    .exit { background: #00b894; border-radius: 6px; }

    #controls {
      margin-top: 10px;
      text-align: center;
    }

    #start-btn {
      background: #00b894;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }

    #start-btn:hover { background: #019874; }
    #timer { margin-top: 10px; font-size: 18px; }
    #message { margin-top: 10px; font-size: 20px; font-weight: bold; color: #ffeaa7; }

    /* Controles táctiles */
    .touch-controls {
      margin-top: 15px;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      user-select: none;
    }

    .row {
      display: flex;
      gap: 20px;
    }

    .btn {
      width: 60px;
      height: 60px;
      background: #00b894;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 0 10px #00b894;
    }

    @media (max-width: 768px) {
      #game-view {
        width: 95vw;
        height: 65vh;
      }
      .touch-controls { display: flex; }
      .btn { width: 50px; height: 50px; font-size: 25px; }
    }
  </style>
</head>
<body>
  <h1>♻️ Laberinto de Basura 2D</h1>

  <div id="game-view">
    <div id="game-container"></div>
  </div>

  <div id="controls">
    <button id="start-btn">Iniciar Juego</button>
    <div id="timer">Tiempo: 0s</div>
    <div id="message"></div>
  </div>

  <!-- Controles táctiles -->
  <div class="touch-controls">
    <div class="row">
      <div class="btn" id="up">⬆️</div>
    </div>
    <div class="row">
      <div class="btn" id="left">⬅️</div>
      <div class="btn" id="down">⬇️</div>
      <div class="btn" id="right">➡️</div>
    </div>
  </div>

  <script>
    const container = document.getElementById("game-container");
    const gameView = document.getElementById("game-view");
    const timerDisplay = document.getElementById("timer");
    const message = document.getElementById("message");
    const startBtn = document.getElementById("start-btn");

    const map = [
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,2,0,0,0,0,1,3,0,0,0,1,0,3,0,1,0,0,0,1,0,3,0,0,0,0,0,1,3,1],
      [1,0,1,1,1,0,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,1,1,1,1,0,1,0,1],
      [1,0,0,0,0,0,0,0,1,1,0,0,3,0,0,1,0,0,0,1,0,0,0,3,0,1,0,1,0,1],
      [1,0,1,1,1,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,3,1,0,1],
      [1,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,1,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,3,1,0,1,0,1,0,1,0,1,0,1],
      [1,0,0,0,0,0,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1],
      [1,0,1,1,1,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,1,1,0,1,1,1,0,1,0,1],
      [1,3,0,0,0,0,0,1,0,1,0,0,0,1,0,1,1,1,0,1,0,0,0,1,0,1,3,1,0,1],
      [1,0,1,1,1,1,0,0,0,1,0,1,0,0,0,1,0,0,3,1,0,1,0,0,0,1,0,1,0,1],
      [1,0,0,0,3,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
      [1,1,1,0,1,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,3,1],
      [1,0,0,0,0,0,0,1,0,1,3,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1],
      [1,0,1,1,1,1,0,1,0,1,0,0,0,1,0,1,1,1,0,1,0,1,0,1,0,1,3,1,0,1],
      [1,3,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,3,1,0,1,0,1,0,1],
      [1,0,0,0,3,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,4,1],
      [1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    ];

    let playerPos = { x: 1, y: 1 };
    let trashCount = 0;
    let totalTrash = 0;
    let gameStarted = false;
    let time = 0;
    let timerInterval;

    const cellBaseSize = 50; // Tamaño base en píxeles

    function updateCellSize() {
      const cellSize = Math.min(gameView.clientWidth / 10, 50);
      document.documentElement.style.setProperty("--cell-size", `${cellSize}px`);
    }

    window.addEventListener("resize", updateCellSize);
    updateCellSize();

    function renderMap() {
      container.innerHTML = "";
      for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          if (map[y][x] === 1) cell.classList.add("wall");
          if (map[y][x] === 2) cell.classList.add("player");
          if (map[y][x] === 3) cell.classList.add("trash");
          if (map[y][x] === 4) cell.classList.add("exit");
          container.appendChild(cell);
        }
      }
      updateCamera();
    }

    function updateCamera() {
      const cellSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--cell-size"));
      const viewWidth = gameView.clientWidth;
      const viewHeight = gameView.clientHeight;
      const offsetX = playerPos.x * (cellSize + 2) - viewWidth / 2 + cellSize / 2;
      const offsetY = playerPos.y * (cellSize + 2) - viewHeight / 2 + cellSize / 2;
      container.style.left = `${-Math.max(0, Math.min(offsetX, map[0].length * cellSize - viewWidth))}px`;
      container.style.top = `${-Math.max(0, Math.min(offsetY, map.length * cellSize - viewHeight))}px`;
    }

    function move(dx, dy) {
      if (!gameStarted) return;
      const newX = playerPos.x + dx;
      const newY = playerPos.y + dy;
      if (map[newY][newX] === 1) return;

      if (map[newY][newX] === 3) {
        trashCount++;
        map[newY][newX] = 0;
      }

      if (map[newY][newX] === 4) {
        if (trashCount === totalTrash) {
          clearInterval(timerInterval);
          message.textContent = `¡Ganaste! ♻️ Tiempo: ${time}s`;
          gameStarted = false;
        } else {
          message.textContent = "Recolecta toda la basura antes de salir.";
          return;
        }
      }

      map[playerPos.y][playerPos.x] = 0;
      playerPos = { x: newX, y: newY };
      map[newY][newX] = 2;
      renderMap();
    }

    startBtn.addEventListener("click", () => {
      trashCount = 0;
      message.textContent = "";
      time = 0;
      gameStarted = true;
      totalTrash = map.flat().filter((c) => c === 3).length;
      playerPos = { x: 1, y: 1 };
      renderMap();

      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        time++;
        timerDisplay.textContent = `Tiempo: ${time}s`;
      }, 1000);
    });

    document.addEventListener("keydown", (e) => {
      if (!gameStarted) return;
      if (e.key === "ArrowUp") move(0, -1);
      if (e.key === "ArrowDown") move(0, 1);
      if (e.key === "ArrowLeft") move(-1, 0);
      if (e.key === "ArrowRight") move(1, 0);
    });

    // Controles táctiles
    document.getElementById("up").addEventListener("click", () => move(0, -1));
    document.getElementById("down").addEventListener("click", () => move(0, 1));
    document.getElementById("left").addEventListener("click", () => move(-1, 0));
    document.getElementById("right").addEventListener("click", () => move(1, 0));

    renderMap();
  </script>
</body>
</html>
